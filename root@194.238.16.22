#!/bin/bash

# setup_vps.sh
# Run this script ON THE SERVER to install everything.
# Usage: sudo ./setup_vps.sh

echo "ğŸš€ Starting VPS Setup for RoyalKey Video Server..."

# 1. Update System
echo "ğŸ“¦ Updating system packages..."
apt-get update && apt-get upgrade -y

# 2. Install Essentials
echo "ğŸ›  Installing essential tools..."
apt-get install -y curl git ufw build-essential libssl-dev

# 3. Install Node.js (v20 LTS)
echo "ğŸŸ¢ Installing Node.js..."
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt-get install -y nodejs

# 4. Install Redis
echo "ğŸ”´ Installing Redis..."
apt-get install -y redis-server
systemctl enable redis-server
systemctl start redis-server

# 5. Install Nginx
echo "ğŸŒ Installing Nginx..."
apt-get install -y nginx
systemctl enable nginx

# 6. Install Certbot (SSL)
echo "ğŸ”’ Installing Certbot..."
apt-get install -y certbot python3-certbot-nginx

# 7. Install PM2 (Process Manager)
echo "âš™ï¸ Installing PM2..."
npm install -g pm2

# 8. Configure Firewall
echo "ğŸ”¥ Configuring Firewall..."
ufw allow OpenSSH
ufw allow 'Nginx Full'
# ufw enable # Uncomment to enable (careful not to lock yourself out!)

# 9. Create App Directory
echo "ğŸ“‚ Creating app directory..."
mkdir -p /var/www/video-server
chown -R $USER:$USER /var/www/video-server

echo "âœ… VPS Setup Complete! You can now deploy the code."
